<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/ico/favicon.png">

    <title>Реферат 101</title>

    <!-- Bootstrap core CSS -->
    <link href="assets/css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="assets/css/main.css" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/font-awesome.min.css">

    <script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/modernizr.custom.js"></script>
	

	
    <link href='http://fonts.googleapis.com/css?family=Oswald:400,300,700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=EB+Garamond' rel='stylesheet' type='text/css'>

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
      <script src="assets/js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body data-spy="scroll" data-offset="0" data-target="#theMenu">
		
	<!-- Menu -->
	<nav class="menu" id="theMenu">
		<div class="menu-wrap">
			<h1 class="logo"><a href="index.html#home">Навигация</a></h1>
			<i class="icon-remove menu-close"></i>
			<a href="#home" class="smoothScroll">Начало</a>
			<a href="#about" class="smoothScroll">Съдържание</a>
			<a href="#intro" class="smoothScroll">Въведение</a>
			<a href="#code" class="smoothScroll">Инжектиране на код</a>
			<a href="#crlf" class="smoothScroll">CRLF инжекции</a>
			<a href="#mail" class="smoothScroll">Имейл инжекции</a>
			<a href="#header" class="smoothScroll">Хедър атака срещу хоста</a>
			<a href="#ldap" class="smoothScroll">LDAP инжекции</a>
			<a href="#shell" class="smoothScroll">Инжекции на шел команди</a>
			<a href="#xpath" class="smoothScroll">Xpath инжекции</a>
			<a href="#lit" class="smoothScroll">Използвана литература</a>
		</div>
		
		<!-- Menu button -->
		<div id="menuToggle"><i class="icon-reorder"></i></div>
	</nav>


	
	<!-- ========== HEADER SECTION ========== -->
	<section id="home" name="home"></section>
	<div id="headerwrap">
		<div class="container">
			<div class="row">
				<h1>Уязвимости в уеб приложения - инжекции (OWASP-A1). Примери.</h1>
				<br/>
				<h3>Тема 101</h3>
				<br/>
				<br/>
				<div class="col-lg-6 col-lg-offset-3">
				</div>
			</div>
		</div><!-- /container -->
	</div><!-- /headerwrap -->
	
	
	
	<!-- ========== Съдържание ========== -->
	<section id="about" name="about"></section>
	<div id="f">
		<div class="container">
			<div class="row">
				<h3>Съдържание</h3>
				<div style="text-align:left">
					<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
					
					<!-- INTRO INFORMATIO-->
				
					<div class="col-lg-6 col-lg-offset-3">
						<ol> 
							<h4><li><a href="#intro">Въведение</a></li></h4>
							
							<h4><li><a href="#code">Инжектиране на код</a> <br/>
								<ol type="a">
									<h4><li><a href="#code1">Какво представлява инжектиране на код</a></li></h4>
									<h4><li><a href="#code2">Изпълнение на системни команди</a></li></h4>
									<h4><li><a href="#code3">Намиране и предотвратяване на инжектиран код</a></li></h4>
								</ol>
							</li></h4>
							
							<h4><li><a href="#crlf">CRLF инжекции</a> <br/>
								<ol type="a">
									<h4><li><a href="#crlf1">Какво представлява CRLF</a></li></h4>
									<h4><li><a href="#crlf2">Какво представлява разцепване на http заявка</a></li></h4>
									<h4><li><a href="#crlf3">Откриване на CRLF инжекция и защита</a></li></h4>
								</ol>
							</li></h4>

							<h4><li><a href="#mail">Имейл инжекции</a> <br/>
								<ol type="a">
									<h4><li><a href="#">Какво представлява имейл инжекция</a></li></h4>
									<h4><li><a href="#">Как работи SMTP</a></li></h4>
									<h4><li><a href="#">Уязвим код</a></li></h4>
									<h4><li><a href="#">Намиране на уязвим код</a></li></h4>
									<h4><li><a href="#">Превенция</a></li></h4>
								</ol>
							</li></h4>
							
							<h4><li><a href="#header">Хедър атака срещу хоста</a> <br/>
								<ol type="a">
									<h4><li><a href="#">Какво представлява хедър атака срещу хоста</a></li></h4>
									<h4><li><a href="#">Отравяме ма кеша</a></li></h4>
									<h4><li><a href="#">Отравяне на password reset</a></li></h4>
									<h4><li><a href="#">Откриване на уязвимости за отравяне на password reset</a></li></h4>
									<h4><li><a href="#">Превенция</a></li></h4>
								</ol>
							</li></h4>

							<h4><li><a href="#ldap">LDAP инжекции</a></h4></li>
							
							<h4><li><a href="#shell">Инжекции на шел команди</a> <br/>
							<ol type="a">
								<h4><li><a href="#">Какво представлява нжекция на шел команди</a></li></h4>
								<h4><li><a href="#">Пример за инжекция на шел команда</a></li></h4>
								<h4><li><a href="#">Инжекция чрез специални символи</a></li></h4>
								<h4><li><a href="#">Защита от инжекции на шел команди</a></li></h4>
							</ol>
							</li></h4>
							
							<h4><li><a href="#xpath">Xpath инжекции</a></h4></li>
							
							<h4><li><a href="#lit">Използвана литература</a></h4></li>
						</ol>
					</div>								
				</div>
			</div>
		</div><!-- /container -->
	</div><!-- /f -->
	

	<!-- ========== Въведение ========== -->	
	<section id="intro" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Въведение</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>

                                <div class="col-lg-6 col-lg-offset-3">

				<p>Атаките от тип инжекция са обощение за множество различни техники за постигане на желан ефект чрез надхитряне на дадена система. При атака чрез инжекция, атакуващият вкарва нежелани данни в дадена програма. Инжектираните данни се обработват от системата като обикновени такива. В резултат на това се получава нежелан от потребителя изход, от който атакуващият може да се възползва.</p>
				<p>Инжекциите са сред най-старите инструменти за атака над уеб приложения. Те водят до за кражба на данни, загуба на данни, загуба на цялостност на данни, отказ в системата, както и цялостно сриване на системата. Най-честата причина за уязвимост към инжекции е слабо валидиране на потребителски вход.</p>
<p>Този тип атака се смята за един от най-големите проблеми в киберсигурността. OWASP Top 10 я поставя на първо място като опасност в интернет заплахите, при това с основание. Атаките чрез инжекции, най-вече SQL инжекции (SQLi атаки) и скриптове през сайтове (XSS), са не само опасни, но и много разпространени, особено в остарелите legacy приложения. В този доклад няма да говоря за XSS, защото друг колега има такава тема, а не трябва да се припокриваме.</p>
<p>Това, което прави атаките чрез инжекции толкова трудни за предотвратяване е огромната площ, по която те могат да се случат (особено  XSS и SQL атаките). Също така този тип атаки са много добре анализиран и ясен проблем, който позволява на злонамерените лица да знаят точно какво правят. Поради тази причина съществуват множество отлични инструменти, които позволяват дори на хора с малък опит да намират такива слабости и да се възползват от тях.</p>
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->
	
	<!-- ========== Инжектиране на код ========== -->	
	<section id="code" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Инжектиране на код</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				<div class="col-lg-6 col-lg-offset-3">
				<h4 id="code1">Какво представлява инжектиране на код</h4>	
				<p>Инжектирането на код или изпълнението на код от разстояние (RCE) позволява на атакуващият да изпълни злонамерен код като резултат от атака чрез инжекция. Атаките чрез инжекция на код са различни от атаките чрез инжекция на системни команди.Възможностите за атакуващия зависят от ограниченията на сървър-клиент интерпретатора(например PHP, Python, и други). В някои случаи, атакуващият може да е способен да стигне от инжекция на код до инжекция на системни команди.</p>
				<p>Обикновено, инжекции на код се случват, когато приложение обработва входни данни без предварително да ги валидира. Ето примерн код на PHP приложение като пример за уязвимост от инжекция на код:<p>

				<div style="text-align:left">
					<p>/**</p>
					<p>* Get the code from a GET input</p>
					<p>* Example - http://example.com/?code=phpinfo();</p>
					<p>*/</p>
					<p>$code = $_GET['code'];</p>
					<p></p>
					<p>/**</p>
					<p>* Unsafely evaluate the code</p>
					<p>* Example - phpinfo();</p>
					<p>*/</p>
					<p>eval("\$code;");</p>
					<p></p>
				</div>
				<p>На основа горния пример, атакуващият би могъл да използва следния трик, за да изпълни PHP код. Като резултат, PHP информационната страница ще се покажe.</p>
				<p>http://example.com/?code=phpinfo();</p>

		                <h4 id="code2">Изпълнение на системни команди</h4>
				<p>Атакуващият може да е способен да превърне инжектиране на код в инжектиране на команда в самата операционна система на сървъра. Използвайки примера от горната подточка, атакуващият може да изпълни командата whoami, изполвайки функцията system() на PHP</p>
				<p>http://example.com/?code=system('whoami');</p>
				<p>Веднъж получил достъп до системата, атакуващият има възможност да инсталира допълнителен зловреден софтуер и от там да постигне още по-големи щети върху системата и дори върху други системи в интернет.</p>

 				<h4 id="code3">Намиране и предотвратяване на инжектиран код</h4>
				<p>За щастие е много лесно да се тества дали сайт или уеб приложение е уязвимо от инжектиране на код и други потенциални слабости в системата, чрез използване на автоматизиран скенер за сайтове (например Acunetix vulnerability scanner.)</p>

				<p>Ако намерите уязвимост от инжектиране на код, най-ефективният метод за тяхното елиминиране е да се избягва оценяване на код на всяка цена освен ако не е абсолютно необходимо (например, няма друг начин да се постигне желаната функционалност освен чрез оценка на кода). Основно оценяване на код, който съдържа потребителски вход е опасно и почти винаги води до проблеми. Има популярна мантра за PHP оценявщата функция: “eval() is evil”. Ако оценяване на код е необходимо трябва да се използват силни валидации на входа. Това изисква колкото се може повече ограничения за непроверени данни. Важно е да се запомни, че атакуващите могат да използват различни инструменти, за да заобиколят валидиращите условия.</p>

				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	
	<!-- ========== CRLF инжекции ========== -->	
	<section id="crlf" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>CRLF инжекции </h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
			     	<h4 id="crlf1">Какво представлява CRLF</h4>
				<p>CRLF инжекции са друг тип инжекционни атаки. Може да се използва, за да се стигне до по-сериозни зловредни атаки като например Cross-site Scripting (XSS), инжекция на уеб страница, отравяне на кеша и други . Уязвимост към CRLF съществува ако атакуващият е способен да въведе CRLF символи в уеб приложението, например чрез потребителски вход или HTTP заявка.</p>
				<p>CRLF абревиатурата се отнася за "Carriage Return and Line Feed". CR и LF са специални символи (ASCII 13 и 10 съответно, които се изобразяват по следния начин - \r\n) и се използват, за да се отбележи край на съответния ред и да се премине на нов. CRLF се използва в някои операционни системи като Windows (но не и Linux/UNIX) и в интернет протоколи като HTTP.</p>
				<p>Това са двете най-чести срещания на атаки чрез CRLF инжекции: отравяне на логове и разцепване на HTTP отговори. В първия случай атакуващият отравя логоврете като поставя нов ред и добавя още редове. Тази атака се използва, за да се заличи друга атака, или за да се заблуди системния администратор. В другия случай CRLF инжекцията се използва, за да се добавят HTTP хедъри в HTTP отговора и по този начин да се стигне до XSS атака, например, което да доведе до проблеми в системата. Подобна техника, наречена инжекция на имейл хедъри, може да се използва за добавяне на  SMTP хедъри към имейл.</p>

				<h4 id="crlf2">Какво представлява разцепване на http заявка</h4>
				<p>HTTP протоколът използва CRLF символни последователности, за да означи къде един хедър свършва и започва друг. Също така ги използва, за да отбележи къде свършват хедърите и къде започва съдържанието на уеб сайта.</p>
				<p>Ако атакуващият добави един CRLF символ той може добави нов хедър. Ако това е например хедър за локация, атакуващият може да пренасочва потребителите на сайта към друг сайт по негов избор. Обикновено това е с престъпна цел и се прави фишинг. Тази техника се нарича инжекция на HTTP хедър.</p>
				<p>Ако атакуващият добави два CRLF, той може перманентно да изключи хедърите и да инжектира съдържание преди истинското уеб съдържание. Инжектираното съдържание може да съдържа JavaScript код. Също така може да се направи така, че браузърът да игнорира реалното уеб съдържание на сайта. По този начин работи разцепването на HTTP отговор комбинирано с XSS атаки.</p>
				<p> Следният опростен пример използва CRLF, за да: </p>
				<ol>
					<li>Добави фалшив HTTP response хедър: Content-Length: 0. Това кара уеб браузърът да третира хедъра като термниран отговор а да започне да обработва нов отговор</li>
					<li>Добави нов фалшив HTTP отговор: HTTP/1.1 200 OK. Това започва нов отговор.</li>
					<li>Добавяне на друг фалшив HTTP response хедър: Content-Type: text/html. Това е нужно на браузърът да анализира правилно съдържанието.</li>
					<li>Добавяне на още един фалшив HTTP response header: Content-Length: 25. Това кара браузърът да обработи само следващите 25 байта.</li>
					<li>Добави уеб съдържание чрез XSS:  &ltscript &gtalert(1) &lt/script&gt. Това съдържание има точно 25 байта. </li>
					<li>Заради дължината на хедъра за уеб съдържание, уеб браузърът игнорира реалното съдържание на сайта, което идва от уеб сървъра. </li>
				</ol>
				<p>http://www.example.com/somepage.php?page=%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2025%0d%0a%0d%0a%3Cscript%3Ealert(1)%3C/script%3E</p>

				<h4 id="crlf3">Откриване на CRLF инжекция и защита</h4>
				<p>Влиянието на CRLF може да изглежда ограничено. CRLF инжекциите дори не се споменават в OWASP топ 10 2017 списъка за уеб опасности. Обаче атакуващите могат ефективно да използватCRLF инжекции, за да стигнат до по=сериозни атаки, които да изложат други слабости на уеб приложението. Затова, трябва да се отнасяме сериозно към слабостите към CRLF инжекции.</p>
				<p>За щастие е лесно да се тества дали вашият уеб сайт или уеб приложение е уязвимо от CRLF инжекции и други слабости като се използва автоматизиран уеб скенер като Acunetix vulnerability scanner.</p>
				<p>Уязвимост към CRLF инжекции обикновено са отстранени от уеб фреймъркове автоматично. Дори да не бъде засечена, уязвимостта към такива неща е лесна за остраняване:</p>
				
				<ul>
					<li>Опция 1: Промени си кода така, че потребителският вход да не си взаимодейства с кода.</li>
					<li>Опция 2: Да се изрежат всички символи за нов ред преди да започне обработката на потребителски данни.</li>
					<li>Опция 3: Кодиране на даннитите, които подавате на HTTP хедъри. Това силно ще повлияе на CRLF инжекциите ако някой се опита да ви нападне.</li>
				</ul>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
<p></p>
	
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	<!-- ========== Имейл инжекции ========== -->	
	<section id="mail" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Имейл инжекции</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
				
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	<!-- ========== Хедър атака срещу хоста ========== -->	
	<section id="header" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Хедър атака срещу хоста</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
				
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	<!-- ========== LDAP инжекции ========== -->	
	<section id="ldap" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>LDAP инжекции</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
				
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	<!-- ========== Инжекции на шел команди ========== -->	
	<section id="shell" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Инжекции на шел команди</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
				
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

	<!-- ========== Xpath инжекции ========== -->	
	<section id="xpath" name="portfolio"></section>
	<div id="f">
		<div class="container">
			<div class="row centered">
				<h3>Xpath инжекции</h3>
				<p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>
				
				<div class="col-lg-6 col-lg-offset-3">
				
				</div><!-- col-lg-8 -->
			</div><!-- row -->
		</div><!-- container -->
	</div>	<!-- f -->

       <!-- ========== Използвана литература ========== -->
        <section id="lit" name="portfolio"></section>
        <div id="f">
                <div class="container">
                        <div class="row centered">
                                <h3>Използвана литература</h3>
                                <p class="centered"><i class="icon icon-circle"></i><i class="icon icon-circle"></i><i class="icon icon-circle"></i></p>

                                <div class="col-lg-6 col-lg-offset-3">

                                </div><!-- col-lg-8 -->
                        </div><!-- row -->
                </div><!-- container -->
        </div>  <!-- f -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	<script src="assets/js/classie.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    <script src="assets/js/smoothscroll.js"></script>
	<script src="assets/js/main.js"></script>
</body>
</html>
